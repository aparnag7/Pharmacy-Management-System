import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.EventQueue;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.IOException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.Calendar;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JTextField;
import javax.swing.border.EmptyBorder;
import javax.swing.UIManager;
import javax.swing.UnsupportedLookAndFeelException;
import javax.swing.JComboBox;
import com.toedter.calendar.JDayChooser;
import com.toedter.calendar.JCalendar;
import java.awt.SystemColor;
import java.awt.TextField;

import com.toedter.calendar.JDateChooser;
import javax.swing.SwingConstants;
import java.awt.Insets;
import javax.swing.JRadioButton;
import javax.swing.JList;
import javax.swing.ListSelectionModel;
import javax.swing.AbstractListModel;
import javax.swing.ButtonGroup;
import javax.swing.JScrollBar;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.SpinnerNumberModel;
import javax.swing.JRadioButtonMenuItem;

public class MessageOthers extends JFrame{
	JPanel panel;
	private JPanel contentPane;
	private JTextField message;
	int msg_id = 0;
	int emp_id=0;
	int receiver_id = 0;
	public static void main(String[] args) {
		// TODO Auto-generated method stub
		
	}
	public MessageOthers(String username, String receiver) {
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setBounds(450, 190, 1014, 597);
        setResizable(false);
        contentPane = new JPanel();
        contentPane.setBackground(new Color(250, 128, 114));
        contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));
        setContentPane(contentPane);
        contentPane.setLayout(null);   

        JLabel lblAddDrugs = new JLabel("Add new Drugs");
        lblAddDrugs.setForeground(new Color(240, 255, 240));
        lblAddDrugs.setFont(new Font("Trebuchet MS", Font.BOLD, 42));
        lblAddDrugs.setBounds(362, 52, 325, 50);
        contentPane.add(lblAddDrugs);
        
        JLabel lblSelectEmployeeTo = new JLabel("Select Employee to message");
        lblSelectEmployeeTo.setForeground(new Color(240, 255, 240));
        lblSelectEmployeeTo.setFont(new Font("Trebuchet MS", Font.BOLD, 28));
        lblSelectEmployeeTo.setBounds(83, 171, 381, 76);
        contentPane.add(lblSelectEmployeeTo);
        
        JComboBox comboBox = new JComboBox();
        comboBox.setBounds(582, 204, 189, 22);
        contentPane.add(comboBox);
        
        message = new JTextField();
        message.setBounds(462, 267, 508, 149);
        contentPane.add(message);
        message.setColumns(10);
        
        JLabel lblEnterMessage = new JLabel("Enter Message");
        lblEnterMessage.setForeground(new Color(240, 255, 240));
        lblEnterMessage.setFont(new Font("Trebuchet MS", Font.BOLD, 24));
        lblEnterMessage.setBounds(83, 311, 325, 50);
        contentPane.add(lblEnterMessage);
        try {
        	Class.forName("com.mysql.jdbc.Driver");
			Connection connection = (Connection) DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb","root", "Phoebe2001#");
			Statement statement = connection.createStatement();
			
			String query = "select * from users  where name= '"+username+"'"  ;
			ResultSet resultSet = statement.executeQuery(query);
			while(resultSet.next()) {
      			emp_id = resultSet.getInt("idusers");
      		}
			System.out.println(emp_id);
			
			String query2 = "select * from users where idusers";
			ResultSet resultSet2 = statement.executeQuery(query2);
			while(resultSet2.next()) {
      			String curr_user = resultSet2.getString("name");
      			int curr_id  = resultSet2.getInt("idusers");
      			if(curr_id != emp_id)
      				comboBox.addItem(curr_user);
      		}
        }
        catch(Exception e1) {
        	e1.printStackTrace();
        }
        try {
        	Class.forName("com.mysql.jdbc.Driver");
			Connection connection = (Connection) DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb","root", "Phoebe2001#");
			Statement statement = connection.createStatement();
			
			String query = "select * from numberkeys where slno = 1";
			ResultSet resultSet = statement.executeQuery(query);
			while(resultSet.next()) {
      			msg_id = resultSet.getInt("msgid");
      		}
			System.out.println(msg_id);
			msg_id+=1;
        }
        catch(Exception e1) {
        	e1.printStackTrace();
        }
        if(receiver!=null) {
        	comboBox.setSelectedItem(receiver);
        }
        
        comboBox.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		try {
        			Class.forName("com.mysql.jdbc.Driver");
        			Connection connection = (Connection) DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb","root", "Phoebe2001#");
        			Statement statement = connection.createStatement();
        			String receiver = (String) comboBox.getSelectedItem();
        			String query = "select * from users  where name= '"+receiver+"'"  ;
        			ResultSet resultSet = statement.executeQuery(query);
        			while(resultSet.next()) {
              			receiver_id = resultSet.getInt("idusers");
              		}
        			System.out.println("Receiver id: "+receiver_id);
        			
        		}
        		catch(Exception ee){
        			
        		}
        	}
        });
        
        JButton btnNewButton = new JButton("Send");
        btnNewButton.setFont(new Font("Trebuchet MS", Font.PLAIN, 17));
        btnNewButton.setForeground(new Color(0, 206, 209));
        btnNewButton.setBounds(362, 442, 200, 50);
        contentPane.add(btnNewButton);
        
        btnNewButton.addActionListener(new ActionListener() {
        	public void actionPerformed(ActionEvent e) {
        		try {
                	Class.forName("com.mysql.jdbc.Driver");
        			Connection connection = (Connection) DriverManager.getConnection("jdbc:mysql://localhost:3306/mydb","root", "Phoebe2001#");
        			Statement statement = connection.createStatement();
        			
        			String query1 = "insert into messages (msgid,senderid,receiverid,message,timestamp)" + "values(?,?,?,?,?)";
        			PreparedStatement preparedStmt = connection.prepareStatement(query1);
                    preparedStmt.setInt(1, msg_id);
                    preparedStmt.setInt(2, emp_id);
                    preparedStmt.setInt(3,receiver_id);
                    preparedStmt.setString(4,message.getText());
                    Calendar calendar = Calendar.getInstance();            
                    preparedStmt.setTimestamp(5,new java.sql.Timestamp(new java.util.Date().getTime())); //CURRENT DATE AND TIME 
                    preparedStmt.execute();
                    System.out.print("Entered");
                    JOptionPane.showMessageDialog(null, "Message Sent Successfully");
        			String query2 = "update numberkeys set msgid =  '"+msg_id +"' where slno = 1";
                    statement.executeUpdate(query2);
                    System.out.println("Done updating msgid");
                    System.out.println(msg_id);
                }
                catch(Exception e1) {
                	e1.printStackTrace();
                }
        	}
        });
	}
}
